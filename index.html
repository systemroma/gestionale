<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestionale Incassi Corsi</title>
    <!-- Carica Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Carica il font Inter -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap">
    <style>
        /* Applica il font Inter come default */
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Stile per un loader semplice */
        .loader {
            border-top-color: #3498db;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-100">

    <div class="container mx-auto p-4 md:p-8 max-w-7xl">
        
        <!-- Intestazione -->
        <header class="mb-6">
            <h1 class="text-4xl font-bold text-gray-800">Gestionale Incassi Corsi</h1>
            <p id="auth-status" class="text-gray-600 mt-1">
                Connessione in corso...
                <span id="user-id" class="font-mono text-sm p-1 bg-gray-200 rounded hidden"></span>
            </p>
        </header>

        <!-- Riepilogo Finanziario a Scomparsa -->
        <div class="bg-white p-4 rounded-lg shadow-md mb-6">
            <div class="flex justify-between items-center">
                <h2 class="text-2xl font-semibold text-gray-800">Riepilogo Finanziario</h2>
                <button id="toggle-summary-btn" class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition">
                    Mostra
                </button>
            </div>
            
            <!-- Contenuto del Riepilogo (Nascosto di default) -->
            <div id="summary-content" class="hidden mt-4 pt-4 border-t border-gray-200 grid grid-cols-1 md:grid-cols-3 gap-4">
                <div>
                    <p class="text-sm font-medium text-gray-500 uppercase">Totale Incassi</p>
                    <p id="total-incassi" class="text-3xl font-bold text-green-600">€0.00</p>
                </div>
                <div>
                    <p class="text-sm font-medium text-gray-500 uppercase">Totale Uscite</p>
                    <p id="total-uscite" class="text-3xl font-bold text-red-600">€0.00</p>
                </div>
                <div>
                    <p class="text-sm font-medium text-gray-500 uppercase">Saldo Attuale</p>
                    <p id="total-saldo" class="text-3xl font-bold text-blue-700">€0.00</p>
                </div>
            </div>
        </div>

        <!-- Contenuto Principale: Form + Lista -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">

            <!-- Colonna 1: Form Aggiungi Incasso -->
            <div class="lg:col-span-1 bg-white p-6 rounded-lg shadow-md">
                <h2 class="text-2xl font-semibold mb-5 text-gray-800 border-b pb-2">
                    Aggiungi Movimento
                </h2>

                <!-- Messaggio di Errore -->
                <div id="error-message" class="p-4 mb-4 text-sm text-red-800 bg-red-100 rounded-lg hidden" role="alert">
                    <span class="font-medium">Errore:</span> <span id="error-text"></span>
                </div>

                <!-- Form -->
                <form id="incasso-form" class="space-y-4">
                    
                    <!-- Campo: Corso -->
                    <div>
                        <label for="corso" class="block text-sm font-medium text-gray-700 mb-1">
                            Corso
                        </label>
                        <select id="corso" name="corso" class="w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                            <option>Corso Base di Programmazione</option>
                            <option>Corso Avanzato di Design</option>
                            <option>Workshop Marketing Digitale</option>
                            <option>Seminario Public Speaking</option>
                            <option>Altro</option>
                        </select>
                    </div>

                    <!-- Campo: Data -->
                    <div>
                        <label for="data" class="block text-sm font-medium text-gray-700 mb-1">
                            Data Svolgimento
                        </label>
                        <input type="date" id="data" name="data" class="w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500" required>
                    </div>

                    <!-- Campo: Costo per Partecipante -->
                    <div>
                        <label for="costo-per-partecipante" class="block text-sm font-medium text-gray-700 mb-1">
                            Costo per Partecipante (€)
                        </label>
                        <input type="number" id="costo-per-partecipante" name="costo-per-partecipante" min="0" step="0.01" placeholder="Es. 50" class="w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500" required>
                    </div>

                    <!-- Campo: Numero Partecipanti -->
                    <div>
                        <label for="num-partecipanti" class="block text-sm font-medium text-gray-700 mb-1">
                            Numero Partecipanti
                        </label>
                        <input type="number" id="num-partecipanti" name="num-partecipanti" min="1" step="1" placeholder="Es. 10" class="w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500" required>
                    </div>

                    <!-- Campo: Costo Libero -->
                    <div>
                        <label for="costo-libero" class="block text-sm font-medium text-gray-700 mb-1">
                            Costi Extra Incasso (€) <span class="text-gray-500">(Opzionale)</span>
                        </label>
                        <input type="number" id="costo-libero" name="costo-libero" min="0" step="0.01" placeholder="Es. 25.50" value="0" class="w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                    </div>

                    <!-- Campo: Costo Personale (Uscita) -->
                    <div class="pt-4 border-t mt-4">
                        <label for="costo-personale" class="block text-sm font-medium text-gray-700 mb-1">
                            Costo Personale (Uscita) <span class="text-gray-500">(Opzionale)</span>
                        </label>
                        <input type="number" id="costo-personale" name="costo-personale" min="0" step="0.01" placeholder="Es. 100" value="0" class="w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                        <p class="text-xs text-gray-500 mt-1">Verrà salvato come un'uscita separata con la stessa data.</p>
                    </div>

                    <!-- Riepilogo Calcolo -->
                    <div class="mt-6 p-4 bg-blue-50 rounded-lg border border-blue-200">
                        <h3 class="text-lg font-semibold text-gray-800">Totale Incasso Calcolato</h3>
                        <p id="calcolo-totale" class="text-xl font-bold text-blue-600">
                            €0.00
                        </p>
                    </div>

                    <!-- Pulsante Submit -->
                    <button type="submit" id="submit-btn" class="w-full bg-blue-600 text-white p-3 rounded-md font-semibold hover:bg-blue-700 transition duration-200 shadow-md disabled:bg-gray-400 disabled:cursor-not-allowed">
                        Salva Movimento
                    </button>
                </form>
            </div>

            <!-- Colonna 2: Lista dei Movimenti (Incassi + Uscite) -->
            <div class="lg:col-span-2 bg-white p-6 rounded-lg shadow-md">
                <h2 class="text-2xl font-semibold mb-5 text-gray-800 border-b pb-2">
                    Movimenti Registrati
                </h2>
                
                <!-- Stato di Caricamento -->
                <div id="loading-state" class="text-center p-10 text-gray-600">
                    <div class="loader ease-linear rounded-full border-4 border-t-4 border-gray-200 h-12 w-12 mx-auto mb-4"></div>
                    <p>Caricamento movimenti dal database...</p>
                </div>
                
                <!-- Stato Vuoto -->
                <div id="empty-state" class="text-center p-10 bg-gray-50 rounded-lg hidden">
                    <p class="text-gray-600">Nessun movimento ancora registrato.</p>
                    <p class="text-sm text-gray-500 mt-1">Compila il modulo a sinistra per iniziare.</p>
                </div>
                
                <!-- Lista Movimenti -->
                <ul id="movimenti-list" class="space-y-4 max-h-[80vh] overflow-y-auto pr-2">
                    <!-- Gli elementi (incassi e uscite) verranno aggiunti qui da JS -->
                </ul>
            </div>

        </div>
    </div>

    <!-- CARICA LA CONFIGURAZIONE PRIMA DELLO SCRIPT PRINCIPALE -->
    <!-- Questo file DEVE contenere: const firebaseConfig = { ... }; -->
    <!-- Questo file è ignorato da Git (vedi .gitignore) -->
    <script src="firebase-config.js"></script>

    <!-- Script per Firebase e logica dell'app -->
    <script type="module">
      // Import necessari da Firebase (MODIFICATI per Cloud Firestore)
      import { initializeApp, setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
      import { 
        getAuth, 
        signInAnonymously, 
        signInWithCustomToken, 
        onAuthStateChanged 
      } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
      import { 
        getFirestore, // MODIFICATO: Non più getDatabase
        collection,   // MODIFICATO
        doc,          // MODIFICATO
        onSnapshot,   // MODIFICATO
        addDoc,       // MODIFICATO
        deleteDoc,    // MODIFICATO
        query         // MODIFICATO
      } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

      // --- Variabili Globali (MODIFICATE PER IL TUO PROGETTO REALE) ---
      
      // La variabile `firebaseConfig` ora è caricata dal file esterno `firebase-config.js`
      
      // Controllo per assicurarsi che il file sia stato caricato
      if (typeof firebaseConfig === 'undefined') {
        const errorMsg = "ERRORE: `firebaseConfig` non trovato. Assicurati che `firebase-config.js` sia presente e contenga la configurazione.";
        console.error(errorMsg);
        document.body.innerHTML = `<div class="p-8 text-center text-red-600">${errorMsg}</div>`;
        throw new Error(errorMsg);
      }
      
      // Usiamo il projectId per il path del database.
      const appId = firebaseConfig.projectId || 'default-app-id';
      
      // Nel tuo progetto reale, `initialAuthToken` non esisterà.
      // Il codice gestirà automaticamente il login anonimo (signInAsGuest).
      // @ts-ignore
      const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
      
      // ----------------------------------------------------

      // Variabili di stato globali
      let db, auth, userId, isAuthReady = false;
      let pathIncassi = ''; // Path string
      let localIncassi = []; // Cache locale dei dati
      let pathUscite = ''; // Path string
      let localUscite = []; // Cache locale delle uscite

      // Elementi DOM
      const authStatus = document.getElementById('auth-status');
      const userIdEl = document.getElementById('user-id');
      const incassoForm = document.getElementById('incasso-form');
      const submitBtn = document.getElementById('submit-btn');
      const movimentiList = document.getElementById('movimenti-list');
      const loadingState = document.getElementById('loading-state');
      const emptyState = document.getElementById('empty-state');
      
      // Elementi Form
      const dataInput = document.getElementById('data');
      const costoInput = document.getElementById('costo-per-partecipante');
      const numInput = document.getElementById('num-partecipanti');
      const liberoInput = document.getElementById('costo-libero');
      const costoPersonaleInput = document.getElementById('costo-personale');
      const calcoloTotale = document.getElementById('calcolo-totale');
      
      // Elementi Riepilogo
      const toggleSummaryBtn = document.getElementById('toggle-summary-btn');
      const summaryContent = document.getElementById('summary-content');
      const totalIncassiEl = document.getElementById('total-incassi');
      const totalUsciteEl = document.getElementById('total-uscite');
      const totalSaldoEl = document.getElementById('total-saldo');
      
      // Elementi Errore
      const errorMessage = document.getElementById('error-message');
      const errorText = document.getElementById('error-text');

      /**
       * Inizializza l'applicazione al caricamento della pagina
       */
      document.addEventListener('DOMContentLoaded', () => {
        initializeFirebase();
        setupFormListeners();
        setupSummaryToggle();
        
        // Imposta la data di oggi come default
        dataInput.valueAsDate = new Date();
      });

      /**
       * 1. Inizializza Firebase e l'autenticazione
       */
      function initializeFirebase() {
        // Abilita i log di Firebase per il debug
        setLogLevel('Debug');
        
        try {
          const app = initializeApp(firebaseConfig);
          db = getFirestore(app); // MODIFICATO: da getDatabase a getFirestore
          auth = getAuth(app);
          
          console.log("Firebase (Cloud Firestore) inizializzato correttamente.");
          setupAuthListener();

        } catch (e) {
          console.error("Errore inizializzazione Firebase:", e);
          showError(`Errore inizializzazione Firebase: ${e.message}`);
          authStatus.textContent = "Errore di connessione.";
        }
      }

      /**
       * 2. Imposta il listener per lo stato di autenticazione
       */
      function setupAuthListener() {
        onAuthStateChanged(auth, (user) => {
          if (user) {
            // Utente già loggato (anonimo o no)
            onUserAuthenticated(user.uid);
          } else if (initialAuthToken) {
            // Se siamo in un ambiente "Preview" con un token
            console.log("Autenticazione con token personalizzato...");
            signInWithCustomToken(auth, initialAuthToken).catch((error) => {
              console.error("Errore signInWithCustomToken, tento login anonimo:", error);
              signInAsGuest(); // Fallback
            });
          } else {
            // Login anonimo per il progetto reale
            console.log("Nessun utente, tento login anonimo...");
            signInAsGuest();
          }
        });
      }

      /**
       * 2b. Esegue il login come utente anonimo
       */
      function signInAsGuest() {
        signInAnonymously(auth).catch((error) => {
          console.error("Errore login anonimo:", error);
          showError(`Impossibile autenticarsi anonimamente: ${error.message}`);
          authStatus.textContent = "Autenticazione fallita.";
        });
      }

      /**
       * 3. Chiamata quando l'utente è autenticato con successo
       */
      function onUserAuthenticated(uid) {
        userId = uid;
        isAuthReady = true;

        // Costruisci i path *privati* per i dati dell'utente
        pathIncassi = `/artifacts/${appId}/users/${userId}/incassi`;
        pathUscite = `/artifacts/${appId}/users/${userId}/uscite`;
        
        console.log(`Utente autenticato: ${userId}`);
        console.log(`Path database incassi (Firestore): ${pathIncassi}`);
        console.log(`Path database uscite (Firestore): ${pathUscite}`);
        
        // Aggiorna l'interfaccia
        authStatus.textContent = "Connesso. Il tuo ID Utente è:";
        userIdEl.textContent = userId;
        userIdEl.classList.remove('hidden');
        submitBtn.disabled = false;
        
        // Avvia i listener per i dati
        setupSnapshotListenerIncassi();
        setupSnapshotListenerUscite();
      }

      /**
       * 4a. Si mette in ascolto dei cambiamenti sul database (INCASSI)
       * (MODIFICATO per Cloud Firestore)
       */
      function setupSnapshotListenerIncassi() {
        if (!db || !pathIncassi) return;

        // MODIFICATO: onSnapshot su una collection
        const q = query(collection(db, pathIncassi)); 

        onSnapshot(q, (snapshot) => { 
          console.log("Dati (Incassi) ricevuti da Firestore.");
          
          // MODIFICATO: I dati di Firestore sono in snapshot.docs
          localIncassi = [];
          snapshot.docs.forEach((doc) => {
            localIncassi.push({
              id: doc.id,
              ...doc.data()
            });
          });

          // Ri-renderizza la lista e aggiorna i totali
          renderMovimentiList();
          updateSummary();

        }, (error) => {
          console.error("Errore in onSnapshot (Incassi):", error);
          showError("Impossibile caricare gli incassi in tempo reale.");
          loadingState.classList.add('hidden');
        });
      }

      /**
       * 4b. Si mette in ascolto dei cambiamenti sul database (USCITE)
       * (MODIFICATO per Cloud Firestore)
       */
      function setupSnapshotListenerUscite() {
        if (!db || !pathUscite) return;

        // MODIFICATO: onSnapshot su una collection
        const q = query(collection(db, pathUscite)); 

        onSnapshot(q, (snapshot) => { 
          console.log("Dati (Uscite) ricevuti da Firestore.");
          
          // MODIFICATO: I dati di Firestore sono in snapshot.docs
          localUscite = [];
          snapshot.docs.forEach((doc) => {
            localUscite.push({
              id: doc.id,
              ...doc.data()
            });
          });

          // Ri-renderizza la lista e aggiorna i totali
          renderMovimentiList();
          updateSummary();

        }, (error) => {
          console.error("Errore in onSnapshot (Uscite):", error);
          showError("Impossibile caricare le uscite in tempo reale.");
          loadingState.classList.add('hidden');
        });
      }

      /**
       * 5. Imposta i listener sul form
       */
      function setupFormListeners() {
        // Calcolo totale dinamico
        const inputs = [costoInput, numInput, liberoInput];
        inputs.forEach(input => {
          input.addEventListener('input', updateCalcoloTotale);
        });
        
        // Gestione submit
        incassoForm.addEventListener('submit', handleSubmit);
      }
      
      /**
       * 5b. Imposta il listener per il toggle del riepilogo
       */
      function setupSummaryToggle() {
        toggleSummaryBtn.addEventListener('click', () => {
          const isHidden = summaryContent.classList.toggle('hidden');
          toggleSummaryBtn.textContent = isHidden ? 'Mostra' : 'Nascondi';
        });
      }

      /**
       * 6. Gestisce il submit del form (INCASSO + USCITA OPZIONALE)
       * (MODIFICATO per Cloud Firestore)
       */
      async function handleSubmit(event) {
        event.preventDefault(); // Impedisce il ricaricamento della pagina
        if (!isAuthReady) {
          showError("Autenticazione non ancora pronta.");
          return;
        }

        // Blocca il pulsante per evitare doppi click
        submitBtn.disabled = true;
        submitBtn.textContent = "Salvataggio in corso...";

        // Raccogli i dati dal form
        const form = event.target;
        const dataIncasso = {
          corso: form.corso.value,
          data: form.data.value,
          costoPerPartecipante: parseFloat(form['costo-per-partecipante'].value),
          numPartecipanti: parseInt(form['num-partecipanti'].value),
          costoLibero: parseFloat(form['costo-libero'].value) || 0,
          userId: userId,
        };
        // Calcola il totale lato client
        dataIncasso.totale = (dataIncasso.costoPerPartecipante * dataIncasso.numPartecipanti) + dataIncasso.costoLibero;

        const costoPersonale = parseFloat(form['costo-personale'].value) || 0;

        try {
          hideError();
          
          // 1. Salva l'incasso (MODIFICATO: addDoc)
          await addDoc(collection(db, pathIncassi), dataIncasso);
          console.log("Incasso salvato con successo!");
          
          // 2. Salva l'uscita (se presente) (MODIFICATO: addDoc)
          if (costoPersonale > 0) {
            const dataUscita = {
              descrizione: "Costo Personale",
              data: dataInput.value, // Stessa data dell'incasso
              importo: costoPersonale,
              userId: userId
            };
            await addDoc(collection(db, pathUscite), dataUscita);
            console.log("Uscita 'Costo Personale' salvata con successo!");
          }
          
          // Reset del form
          form.reset();
          dataInput.valueAsDate = new Date(); // Reimposta la data a oggi
          updateCalcoloTotale(); // Azzera il calcolo

        } catch (e) {
          console.error("Errore nel salvataggio:", e);
          showError(`Errore nel salvataggio: ${e.message}`);
        } finally {
          // Riabilita il pulsante
          submitBtn.disabled = false;
          submitBtn.textContent = "Salva Movimento";
        }
      }

      /**
       * 7. Renderizza l'intera lista dei movimenti (incassi + uscite)
       */
      function renderMovimentiList() {
        movimentiList.innerHTML = ''; // Pulisce la lista

        // Combina e ordina i dati
        const tuttiMovimenti = [
            ...localIncassi.map(i => ({ ...i, type: 'incasso' })),
            ...localUscite.map(u => ({ ...u, type: 'uscita' }))
        ];

        // Ordina per data, dal più recente al più vecchio
        tuttiMovimenti.sort((a, b) => b.data.localeCompare(a.data));

        if (tuttiMovimenti.length === 0) {
          emptyState.classList.remove('hidden');
          loadingState.classList.add('hidden');
        } else {
          emptyState.classList.add('hidden');
          loadingState.classList.add('hidden');

          tuttiMovimenti.forEach(movimento => {
            const li = document.createElement('li');
            li.className = "bg-white border border-gray-200 p-4 rounded-lg shadow-sm flex items-center justify-between";
            
            if (movimento.type === 'incasso') {
                li.innerHTML = createIncassoHTML(movimento);
                li.querySelector('button').addEventListener('click', () => deleteIncasso(movimento.id));
            } else {
                li.innerHTML = createUscitaHTML(movimento);
                li.querySelector('button').addEventListener('click', () => deleteUscita(movimento.id));
            }
            movimentiList.appendChild(li);
          });
        }
      }
      
      /**
       * 7a. Elimina un documento da Firestore (INCASSO)
       * (MODIFICATO per Cloud Firestore)
       */
      async function deleteIncasso(docId) {
        // Usa un prompt sincrono semplice per la conferma
        // NOTA: in un'app reale, usare un modal custom
        const sic = prompt("Sei sicuro di voler eliminare questo incasso? Scrivi 'SI' per confermare.");
        if (sic !== 'SI') return;

        try {
          hideError();
          const docRef = doc(db, pathIncassi, docId); // MODIFICATO
          await deleteDoc(docRef); // MODIFICATO
          console.log("Documento (Incasso) eliminato:", docId);
        } catch (e) {
          console.error("Errore eliminazione incasso:", e);
          showError(`Errore eliminazione incasso: ${e.message}`);
        }
      }
      
      /**
       * 7b. Elimina un documento da Firestore (USCITA)
       * (MODIFICATO per Cloud Firestore)
       */
      async function deleteUscita(docId) {
        const sic = prompt("Sei sicuro di voler eliminare questa uscita? Scrivi 'SI' per confermare.");
        if (sic !== 'SI') return;

        try {
          hideError();
          const docRef = doc(db, pathUscite, docId); // MODIFICATO
          await deleteDoc(docRef); // MODIFICATO
          console.log("Documento (Uscita) eliminato:", docId);
        } catch (e) {
          console.error("Errore eliminazione uscita:", e);
          showError(`Errore eliminazione uscita: ${e.message}`);
        }
      }

      /**
       * 8. Aggiorna il riepilogo finanziario
       */
      function updateSummary() {
          const totaleIncassi = localIncassi.reduce((sum, item) => sum + item.totale, 0);
          const totaleUscite = localUscite.reduce((sum, item) => sum + item.importo, 0);
          const saldo = totaleIncassi - totaleUscite;

          totalIncassiEl.textContent = formatCurrency(totaleIncassi);
          totalUsciteEl.textContent = formatCurrency(totaleUscite);
          totalSaldoEl.textContent = formatCurrency(saldo);
      }

      /**
       * 9. Aggiorna il calcolo del totale nel form
       */
      function updateCalcoloTotale() {
        const costo = parseFloat(costoInput.value) || 0;
        const num = parseInt(numInput.value) || 0;
        const libero = parseFloat(liberoInput.value) || 0;
        const totale = (costo * num) + libero;
        calcoloTotale.textContent = formatCurrency(totale);
      }

      // --- Funzioni di Utility ---

      /**
       * Mostra un messaggio di errore
       */
      function showError(message) {
        errorText.textContent = message;
        errorMessage.classList.remove('hidden');
      }

      /**
       * Nasconde il messaggio di errore
       */
      function hideError() {
        errorMessage.classList.add('hidden');
        errorText.textContent = '';
      }

      /**
       * Formatta un numero come valuta
       */
      function formatCurrency(value) {
        return new Intl.NumberFormat('it-IT', {
          style: 'currency',
          currency: 'EUR'
        }).format(value);
      }

      /**
       * Formatta la data (YYYY-MM-DD) in un formato leggibile (DD/MM/YYYY)
       */
      function formatDate(dateString) {
          try {
              const [year, month, day] = dateString.split('-');
              return `${day}/${month}/${year}`;
          } catch (e) {
              return dateString; // Fallback
          }
      }
      
      /**
       * Crea l'HTML per un item "Incasso"
       */
      function createIncassoHTML(incasso) {
          return `
              <div class="flex-1">
                  <p class="text-sm text-gray-500">${formatDate(incasso.data)}</p>
                  <p class="text-lg font-semibold text-green-700">
                      + ${formatCurrency(incasso.totale)} (Incasso)
                  </p>
                  <p class="text-sm text-gray-700 font-medium">
                      ${incasso.corso}
                  </p>
                  <p class="text-xs text-gray-500">
                      Dettagli: ${incasso.numPartecipanti} x ${formatCurrency(incasso.costoPerPartecipante)}
                      ${incasso.costoLibero > 0 ? ` + ${formatCurrency(incasso.costoLibero)} extra` : ''}
                  </p>
              </div>
              <button class="flex-shrink-0 bg-red-500 text-white p-2 rounded-md hover:bg-red-600 transition duration-200 shadow-sm" aria-label="Elimina incasso">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                      <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd" />
                  </svg>
              </button>
          `;
      }
      
      /**
       * Crea l'HTML per un item "Uscita"
       */
      function createUscitaHTML(uscita) {
          return `
              <div class="flex-1">
                  <p class="text-sm text-gray-500">${formatDate(uscita.data)}</p>
                  <p class="text-lg font-semibold text-red-700">
                      - ${formatCurrency(uscita.importo)} (Uscita)
                  </p>
                  <p class="text-sm text-gray-700 font-medium">
                      ${uscita.descrizione}
                  </p>
              </div>
              <button class="flex-shrink-0 bg-red-500 text-white p-2 rounded-md hover:bg-red-600 transition duration-200 shadow-sm" aria-label="Elimina uscita">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                      <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd" />
                  </svg>
              </button>
          `;
      }

    </script>

</body>
</html>
